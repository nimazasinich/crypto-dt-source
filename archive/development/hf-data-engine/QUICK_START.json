{
  "title": "HuggingFace Space - Quick Start Guide",
  "subtitle": "راهنمای سریع راه‌اندازی فضای Hugging Face",
  "version": "1.0.0",
  
  "summary": {
    "completed_features": [
      "✅ 25+ REST endpoints implemented (OpenAPI compliant)",
      "✅ HF-first + fallback provider system",
      "✅ Database persistence for all data",
      "✅ WebSocket support for real-time data",
      "✅ Circuit breaker pattern for health tracking",
      "✅ Rate limiting and CORS protection",
      "✅ Meta fields on all responses",
      "✅ Normalization for all providers",
      "✅ In-memory + Redis caching",
      "✅ Authentication for protected endpoints"
    ],
    "key_files": {
      "main_app": "app_complete.py (Complete FastAPI application)",
      "api_client": "core/api_client.py (HF-first + fallback logic)",
      "normalizers": "core/normalizers.py (Response normalization)",
      "config_loader": "core/fallback_config.py (Config file parser)",
      "cache": "core/cache_manager.py (Caching layer)",
      "database": "database/db_manager.py (DB operations)",
      "models": "database/models.py (SQLAlchemy models)"
    }
  },
  
  "installation": {
    "step_1_dependencies": "pip install -r requirements.txt",
    "step_2_database": "python -c \"from database.db_manager import DatabaseManager; db = DatabaseManager('data/hf_space.db'); db.init_database()\"",
    "step_3_config": "Config file will be auto-loaded from /mnt/data/api-config-complete.txt or /workspace/api-resources/api-config-complete__1_.txt",
    "step_4_start": "python app_complete.py",
    "step_5_verify": "Open http://localhost:7860/docs to see API documentation"
  },
  
  "testing": {
    "health_check": "curl http://localhost:7860/api/health",
    "market_data": "curl http://localhost:7860/api/market?limit=10",
    "providers_status": "curl http://localhost:7860/api/providers",
    "system_status": "curl http://localhost:7860/api/status",
    "websocket": "Use browser console or wscat: wscat -c ws://localhost:7860/ws"
  },
  
  "api_endpoints_by_category": {
    "market_data_5_endpoints": [
      "/api/market - Market snapshot with prices",
      "/api/market/pairs - Trading pairs (HF-only required)",
      "/api/market/ohlc - OHLC candlestick data",
      "/api/market/depth - Order book depth",
      "/api/market/tickers - Market tickers"
    ],
    "trading_signals_5_endpoints": [
      "/api/models/{model_key}/predict - Predict with specific model",
      "/api/models/batch/predict - Batch prediction",
      "/api/trading/decision - Trading decision (alias)",
      "/api/signals - Get signal history",
      "/api/signals/ack - Acknowledge signal receipt"
    ],
    "news_3_endpoints": [
      "/api/news - List news articles",
      "/api/news/{id} - Get specific article",
      "/api/news/analyze - Analyze news content"
    ],
    "sentiment_1_endpoint": [
      "/api/sentiment/analyze - Analyze text sentiment"
    ],
    "whale_tracking_2_endpoints": [
      "/api/crypto/whales/transactions - Get whale transactions",
      "/api/crypto/whales/stats - Whale statistics"
    ],
    "blockchain_2_endpoints": [
      "/api/crypto/blockchain/gas - Gas prices",
      "/api/crypto/blockchain/stats - Blockchain statistics"
    ],
    "system_5_endpoints": [
      "/api/providers - List all providers",
      "/api/status - System status and health",
      "/api/health - Simple health check",
      "/api/freshness - Data freshness timestamps",
      "/api/logs/recent - Recent log entries"
    ],
    "websocket_1_endpoint": [
      "/ws - WebSocket connection for real-time updates"
    ]
  },
  
  "data_flow_priority": {
    "step_1": "Try HF HTTP endpoint (primary source)",
    "step_2": "Try HF WebSocket (only for WS-exception endpoints)",
    "step_3": "Try fallback providers in order from config file",
    "step_4": "Return normalized response with meta fields",
    "step_5": "Save all data to database before returning to client",
    "error_handling": "Return 502 with list of attempted providers if all fail"
  },
  
  "meta_fields_on_all_responses": {
    "source": "Provider name (hf, hf-ws, coingecko, binance, etc.)",
    "generated_at": "ISO 8601 timestamp of when response was generated",
    "cache_ttl_seconds": "Recommended cache duration in seconds",
    "attempted": "List of providers tried (only in error responses)",
    "example": {
      "meta": {
        "source": "hf",
        "generated_at": "2025-11-24T10:30:00Z",
        "cache_ttl_seconds": 30
      }
    }
  },
  
  "fallback_providers": {
    "market_data": ["coingecko", "coinmarketcap", "cryptocompare", "coincap", "binance", "coinlore"],
    "explorers": {
      "ethereum": ["etherscan", "blockchair", "blockscout"],
      "bsc": ["bscscan", "bitquery"],
      "tron": ["tronscan", "trongrid"]
    },
    "news": ["cryptopanic", "reddit_crypto"],
    "sentiment": ["alternative_me"],
    "whale_tracking": ["clankapp", "bitquery"],
    "note": "All loaded from /mnt/data/api-config-complete.txt"
  },
  
  "circuit_breaker": {
    "purpose": "Automatically disable failing providers",
    "failure_threshold": 5,
    "timeout_seconds": 60,
    "states": ["closed (healthy)", "open (disabled)", "half_open (testing)"],
    "monitoring": "Check /api/status to see circuit breaker states"
  },
  
  "database_persistence": {
    "location": "data/hf_space.db (SQLite)",
    "tables": [
      "market_prices - All market price data",
      "news_articles - News articles with sentiment",
      "whale_transactions - Large transactions",
      "gas_prices - Gas fee data",
      "sentiment_metrics - Sentiment analysis results",
      "blockchain_stats - Blockchain statistics",
      "providers - Provider configuration",
      "connection_attempts - Connection logs"
    ],
    "automatic": "All fetched data is automatically persisted before returning to client"
  },
  
  "caching": {
    "backend": "In-memory (default) or Redis (optional)",
    "ttl_values": {
      "market_data": "30 seconds",
      "market_pairs": "5 minutes (pairs don't change often)",
      "ohlc": "2 minutes",
      "news": "5 minutes",
      "sentiment": "10 minutes",
      "whale": "1 minute",
      "gas": "30 seconds"
    },
    "redis_config": "Set REDIS_URL environment variable to enable Redis"
  },
  
  "rate_limiting": {
    "market_endpoints": "120 requests/minute",
    "ohlc_endpoints": "60 requests/minute",
    "model_endpoints": "30 requests/minute (requires auth)",
    "health_endpoint": "unlimited",
    "implementation": "slowapi library with per-IP tracking"
  },
  
  "authentication": {
    "protected_endpoints": ["/api/models/*", "/api/trading/decision"],
    "method": "X-API-Key header",
    "example": "curl -H \"X-API-Key: your-key\" http://localhost:7860/api/models/trade-model/predict",
    "note": "Simple implementation - enhance with JWT for production"
  },
  
  "websocket_usage": {
    "url": "ws://localhost:7860/ws",
    "connection": "WebSocket connection with subscribe/unsubscribe",
    "services": ["market_data", "sentiment", "news", "whale_tracking"],
    "subscribe_example": {
      "action": "subscribe",
      "service": "market_data",
      "symbols": ["BTC", "ETH"]
    },
    "response_example": {
      "service": "market_data",
      "symbol": "BTC",
      "price": 45000,
      "change_24h": 2.5,
      "ts": "2025-11-24T10:30:00Z"
    },
    "note": "WebSocket is exception-only. Use REST endpoints for most data."
  },
  
  "cors_configuration": {
    "allowed_origins": ["http://localhost:5173", "http://localhost:8001", "*"],
    "allowed_methods": ["GET", "POST", "PUT", "DELETE"],
    "allowed_headers": ["*"],
    "allows_credentials": true,
    "note": "Configure properly for production deployment"
  },
  
  "testing_your_deployment": {
    "step_1": "Start the server: python app_complete.py",
    "step_2": "Check health: curl http://localhost:7860/api/health",
    "step_3": "Get market data: curl http://localhost:7860/api/market?limit=5",
    "step_4": "Check providers: curl http://localhost:7860/api/providers",
    "step_5": "Check status: curl http://localhost:7860/api/status",
    "step_6": "Open docs: http://localhost:7860/docs",
    "step_7": "Run test script: python test_hf_fallback_behavior.py (if available)"
  },
  
  "production_checklist": [
    "✓ All 25+ endpoints implemented and tested",
    "✓ HF-first fallback logic working",
    "✓ Database persistence active",
    "✓ Meta fields on all responses",
    "✓ Circuit breaker enabled",
    "✓ Rate limiting configured",
    "✓ CORS configured",
    "✓ WebSocket working",
    "✓ Caching implemented",
    "TODO: Add proper JWT authentication",
    "TODO: Enable Redis for production caching",
    "TODO: Add comprehensive logging",
    "TODO: Add metrics (Prometheus/Grafana)",
    "TODO: Add automated health checks",
    "TODO: Add request/response validation",
    "TODO: Add API versioning",
    "TODO: Add comprehensive error handling"
  ],
  
  "troubleshooting": {
    "config_file_not_found": "Check /mnt/data/api-config-complete.txt or /workspace/api-resources/api-config-complete__1_.txt exists",
    "database_errors": "Ensure data/ directory exists and is writable",
    "import_errors": "Run pip install -r requirements.txt",
    "redis_errors": "Redis is optional - will fallback to in-memory cache",
    "provider_failures": "Check /api/status to see circuit breaker states",
    "websocket_issues": "Ensure no firewall blocking WebSocket connections"
  },
  
  "support_and_documentation": {
    "openapi_spec": "../openapi_hf_space.yaml",
    "contract": "../hf_space_implementation_contract.json",
    "deployment_guide": "DEPLOYMENT.json",
    "api_docs": "http://localhost:7860/docs (Swagger UI)",
    "redoc": "http://localhost:7860/redoc (ReDoc)"
  }
}
