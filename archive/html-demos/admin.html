<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Crypto Monitor</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --primary: #667eea;
            --primary-dark: #5568d3;
            --success: #48bb78;
            --warning: #ed8936;
            --danger: #f56565;
            --bg-dark: #1a202c;
            --bg-card: #2d3748;
            --text-light: #e2e8f0;
            --text-muted: #a0aec0;
            --border: #4a5568;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--bg-dark);
            color: var(--text-light);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }
        
        header h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        header .subtitle {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .tab-btn {
            padding: 12px 24px;
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            color: var(--text-light);
            transition: all 0.3s;
        }
        
        .tab-btn:hover {
            background: var(--primary);
            border-color: var(--primary);
        }
        
        .tab-btn.active {
            background: var(--primary);
            border-color: var(--primary);
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.3s;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .card {
            background: var(--bg-card);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
        }
        
        .card h3 {
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: var(--bg-card);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid var(--border);
        }
        
        .stat-card .label {
            color: var(--text-muted);
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .stat-card .value {
            font-size: 32px;
            font-weight: 700;
            color: var(--primary);
            margin: 5px 0;
        }
        
        .stat-card .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
        }
        
        .badge-success {
            background: var(--success);
            color: white;
        }
        
        .badge-warning {
            background: var(--warning);
            color: white;
        }
        
        .badge-danger {
            background: var(--danger);
            color: white;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--primary-dark);
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-success:hover {
            background: #38a169;
        }
        
        .btn-secondary {
            background: var(--bg-card);
            color: var(--text-light);
            border: 1px solid var(--border);
        }
        
        .btn-secondary:hover {
            background: var(--border);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        table thead {
            background: var(--bg-dark);
        }
        
        table th {
            padding: 12px;
            text-align: left;
            font-weight: 600;
            font-size: 12px;
            text-transform: uppercase;
            color: var(--text-muted);
        }
        
        table td {
            padding: 12px;
            border-top: 1px solid var(--border);
        }
        
        table tbody tr:hover {
            background: var(--bg-dark);
        }
        
        .status-online {
            color: var(--success);
        }
        
        .status-offline {
            color: var(--danger);
        }
        
        .status-degraded {
            color: var(--warning);
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-muted);
        }
        
        .error-message {
            background: var(--danger);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .success-message {
            background: var(--success);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-muted);
        }
        
        .empty-state svg {
            width: 64px;
            height: 64px;
            margin-bottom: 20px;
            opacity: 0.3;
        }
        
        .filter-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        select, input {
            padding: 10px;
            border-radius: 6px;
            border: 1px solid var(--border);
            background: var(--bg-dark);
            color: var(--text-light);
        }
        
        .log-entry {
            padding: 10px;
            border-left: 3px solid var(--primary);
            margin-bottom: 10px;
            background: var(--bg-dark);
            border-radius: 4px;
        }
        
        .log-entry.error {
            border-left-color: var(--danger);
        }
        
        .log-timestamp {
            color: var(--text-muted);
            font-size: 12px;
        }
        
        pre {
            background: var(--bg-dark);
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            font-size: 13px;
            line-height: 1.4;
        }
        
        .model-card {
            background: var(--bg-dark);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid var(--primary);
        }
        
        .model-card.valid {
            border-left-color: var(--success);
        }
        
        .model-card.conditional {
            border-left-color: var(--warning);
        }
        
        .model-card.invalid {
            border-left-color: var(--danger);
        }
        
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            table {
                font-size: 12px;
            }
            
            table th, table td {
                padding: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üöÄ Crypto Monitor Admin Dashboard</h1>
            <p class="subtitle">Real-time provider management & system monitoring | NO MOCK DATA</p>
        </header>

        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('status')">üìä Status</button>
            <button class="tab-btn" onclick="switchTab('providers')">üîå Providers</button>
            <button class="tab-btn" onclick="switchTab('market')">üí∞ Market Data</button>
            <button class="tab-btn" onclick="switchTab('apl')">ü§ñ APL Scanner</button>
            <button class="tab-btn" onclick="switchTab('hf-models')">üß† HF Models</button>
            <button class="tab-btn" onclick="switchTab('diagnostics')">üîß Diagnostics</button>
            <button class="tab-btn" onclick="switchTab('logs')">üìù Logs</button>
        </div>

        <!-- Status Tab -->
        <div id="tab-status" class="tab-content active">
            <div class="stats-grid" id="global-stats">
                <div class="stat-card">
                    <div class="label">System Health</div>
                    <div class="value" id="system-health">-</div>
                    <span class="badge badge-success" id="health-badge">Healthy</span>
                </div>
                <div class="stat-card">
                    <div class="label">Total Providers</div>
                    <div class="value" id="total-providers">-</div>
                </div>
                <div class="stat-card">
                    <div class="label">Validated</div>
                    <div class="value" id="validated-providers">-</div>
                </div>
                <div class="stat-card">
                    <div class="label">Database</div>
                    <div class="value">‚úì</div>
                    <span class="badge badge-success">Connected</span>
                </div>
            </div>
            
            <div class="card">
                <h3>Quick Actions</h3>
                <button class="btn btn-primary" onclick="refreshAllData()">üîÑ Refresh All</button>
                <button class="btn btn-success" onclick="runAPL()">ü§ñ Run APL Scan</button>
                <button class="btn btn-secondary" onclick="runDiagnostics()">üîß Run Diagnostics</button>
            </div>
            
            <div class="card">
                <h3>Recent Market Data</h3>
                <div id="quick-market-view"></div>
            </div>
        </div>

        <!-- Providers Tab -->
        <div id="tab-providers" class="tab-content">
            <div class="card">
                <h3>Providers Management</h3>
                <div class="filter-bar">
                    <select id="category-filter" onchange="filterProviders()">
                        <option value="">All Categories</option>
                        <option value="market_data">Market Data</option>
                        <option value="sentiment">Sentiment</option>
                        <option value="defi">DeFi</option>
                        <option value="exchange">Exchange</option>
                        <option value="explorer">Explorer</option>
                        <option value="rpc">RPC</option>
                        <option value="news">News</option>
                    </select>
                    <button class="btn btn-secondary" onclick="loadProviders()">üîÑ Refresh</button>
                </div>
                <div id="providers-table"></div>
            </div>
        </div>

        <!-- Market Data Tab -->
        <div id="tab-market" class="tab-content">
            <div class="card">
                <h3>Live Market Data</h3>
                <button class="btn btn-primary" onclick="loadMarketData()">üîÑ Refresh Prices</button>
                <div id="market-data-container"></div>
            </div>
            
            <div class="card">
                <h3>Sentiment Analysis</h3>
                <div id="sentiment-data"></div>
            </div>
            
            <div class="card">
                <h3>Trending Coins</h3>
                <div id="trending-coins"></div>
            </div>
        </div>

        <!-- APL Tab -->
        <div id="tab-apl" class="tab-content">
            <div class="card">
                <h3>Auto Provider Loader (APL)</h3>
                <p style="color: var(--text-muted); margin-bottom: 20px;">
                    APL automatically discovers, validates, and integrates cryptocurrency data providers.
                    All validations use REAL API calls - NO MOCK DATA.
                </p>
                
                <button class="btn btn-success" onclick="runAPL()" id="apl-run-btn">
                    ü§ñ Run APL Scan
                </button>
                <button class="btn btn-secondary" onclick="loadAPLReport()">üìä View Last Report</button>
                
                <div id="apl-status" style="margin-top: 20px;"></div>
            </div>
            
            <div class="card">
                <h3>APL Summary Statistics</h3>
                <div id="apl-summary"></div>
            </div>
            
            <div class="card">
                <h3>APL Output</h3>
                <pre id="apl-output" style="max-height: 400px; overflow-y: auto;">No output yet. Click "Run APL Scan" to start.</pre>
            </div>
        </div>

        <!-- HF Models Tab -->
        <div id="tab-hf-models" class="tab-content">
            <div class="card">
                <h3>Hugging Face Models</h3>
                <p style="color: var(--text-muted); margin-bottom: 20px;">
                    HuggingFace models validated by APL for crypto sentiment analysis and NLP tasks.
                </p>
                <button class="btn btn-primary" onclick="loadHFModels()">üîÑ Refresh Models</button>
                <div id="hf-models-container"></div>
            </div>
            
            <div class="card">
                <h3>HF Services Health</h3>
                <div id="hf-health"></div>
            </div>
        </div>

        <!-- Diagnostics Tab -->
        <div id="tab-diagnostics" class="tab-content">
            <div class="card">
                <h3>System Diagnostics</h3>
                <button class="btn btn-primary" onclick="runDiagnostics(true)">üîß Run with Auto-Fix</button>
                <button class="btn btn-secondary" onclick="runDiagnostics(false)">üîç Run Scan Only</button>
                <button class="btn btn-secondary" onclick="loadLastDiagnostics()">üìã View Last Results</button>
                
                <div id="diagnostics-results" style="margin-top: 20px;"></div>
            </div>
        </div>

        <!-- Logs Tab -->
        <div id="tab-logs" class="tab-content">
            <div class="card">
                <h3>System Logs</h3>
                <button class="btn btn-primary" onclick="loadRecentLogs()">üîÑ Refresh</button>
                <button class="btn btn-danger" onclick="loadErrorLogs()">‚ùå Errors Only</button>
                
                <div id="logs-container" style="margin-top: 20px;"></div>
            </div>
        </div>
    </div>

    <script src="/static/js/api-client.js"></script>
    <script>
        // Tab switching
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(`tab-${tabName}`).classList.add('active');
            event.target.classList.add('active');
            
            // Load data for tab
            switch(tabName) {
                case 'status':
                    loadGlobalStatus();
                    break;
                case 'providers':
                    loadProviders();
                    break;
                case 'market':
                    loadMarketData();
                    loadSentiment();
                    loadTrending();
                    break;
                case 'apl':
                    loadAPLSummary();
                    break;
                case 'hf-models':
                    loadHFModels();
                    loadHFHealth();
                    break;
                case 'diagnostics':
                    loadLastDiagnostics();
                    break;
                case 'logs':
                    loadRecentLogs();
                    break;
            }
        }

        // Global Status
        async function loadGlobalStatus() {
            try {
                const [status, stats] = await Promise.all([
                    apiClient.get('/api/status'),
                    apiClient.get('/api/stats')
                ]);
                
                document.getElementById('system-health').textContent = status.system_health.toUpperCase();
                document.getElementById('total-providers').textContent = status.total_providers;
                document.getElementById('validated-providers').textContent = status.validated_providers;
                
                // Quick market view
                const market = await apiClient.get('/api/market');
                let marketHTML = '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">';
                market.cryptocurrencies.forEach(coin => {
                    const changeClass = coin.change_24h >= 0 ? 'status-online' : 'status-offline';
                    marketHTML += `
                        <div style="background: var(--bg-dark); padding: 15px; border-radius: 8px;">
                            <div style="font-weight: 600;">${coin.name} (${coin.symbol})</div>
                            <div style="font-size: 24px; margin: 10px 0;">$${coin.price.toLocaleString()}</div>
                            <div class="${changeClass}">${coin.change_24h >= 0 ? '‚Üë' : '‚Üì'} ${Math.abs(coin.change_24h).toFixed(2)}%</div>
                        </div>
                    `;
                });
                marketHTML += '</div>';
                document.getElementById('quick-market-view').innerHTML = marketHTML;
                
            } catch (error) {
                console.error('Error loading global status:', error);
                showError('Failed to load global status');
            }
        }

        // Providers
        async function loadProviders() {
            try {
                const response = await apiClient.get('/api/providers');
                const providers = response.providers;
                
                if (providers.length === 0) {
                    document.getElementById('providers-table').innerHTML = '<div class="empty-state">No providers found. Run APL scan to discover providers.</div>';
                    return;
                }
                
                let html = `
                    <table>
                        <thead>
                            <tr>
                                <th>Provider ID</th>
                                <th>Name</th>
                                <th>Category</th>
                                <th>Type</th>
                                <th>Status</th>
                                <th>Response Time</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                providers.forEach(p => {
                    const statusClass = p.status === 'validated' ? 'status-online' : 'status-degraded';
                    html += `
                        <tr>
                            <td><code>${p.provider_id}</code></td>
                            <td>${p.name}</td>
                            <td>${p.category}</td>
                            <td>${p.type}</td>
                            <td class="${statusClass}">${p.status}</td>
                            <td>${p.response_time_ms ? p.response_time_ms.toFixed(0) + 'ms' : 'N/A'}</td>
                        </tr>
                    `;
                });
                
                html += '</tbody></table>';
                document.getElementById('providers-table').innerHTML = html;
                
            } catch (error) {
                console.error('Error loading providers:', error);
                showError('Failed to load providers');
            }
        }

        function filterProviders() {
            // Would filter the providers table
            loadProviders();
        }

        // Market Data
        async function loadMarketData() {
            try {
                const data = await apiClient.get('/api/market');
                
                let html = '<table><thead><tr><th>Rank</th><th>Coin</th><th>Price</th><th>24h Change</th><th>Market Cap</th><th>Volume 24h</th></tr></thead><tbody>';
                
                data.cryptocurrencies.forEach(coin => {
                    const changeClass = coin.change_24h >= 0 ? 'status-online' : 'status-offline';
                    html += `
                        <tr>
                            <td>${coin.rank}</td>
                            <td><strong>${coin.name}</strong> (${coin.symbol})</td>
                            <td>$${coin.price.toLocaleString()}</td>
                            <td class="${changeClass}">${coin.change_24h >= 0 ? '+' : ''}${coin.change_24h.toFixed(2)}%</td>
                            <td>$${(coin.market_cap / 1e9).toFixed(2)}B</td>
                            <td>$${(coin.volume_24h / 1e9).toFixed(2)}B</td>
                        </tr>
                    `;
                });
                
                html += '</tbody></table>';
                html += `<p style="margin-top: 15px; color: var(--text-muted);">Source: ${data.source}</p>`;
                
                document.getElementById('market-data-container').innerHTML = html;
            } catch (error) {
                console.error('Error loading market data:', error);
                document.getElementById('market-data-container').innerHTML = '<div class="error-message">Failed to load market data: ' + error.message + '</div>';
            }
        }

        async function loadSentiment() {
            try {
                const data = await apiClient.get('/api/sentiment');
                
                const fngValue = data.fear_greed_index;
                let color = '--success';
                if (fngValue < 30) color = '--danger';
                else if (fngValue < 50) color = '--warning';
                
                document.getElementById('sentiment-data').innerHTML = `
                    <div style="text-align: center; padding: 20px;">
                        <div style="font-size: 64px; color: var(${color}); font-weight: 700;">${fngValue}</div>
                        <div style="font-size: 24px; margin: 10px 0;">${data.fear_greed_label}</div>
                        <p style="color: var(--text-muted);">Source: ${data.source}</p>
                    </div>
                `;
            } catch (error) {
                console.error('Error loading sentiment:', error);
                document.getElementById('sentiment-data').innerHTML = '<div class="error-message">Failed to load sentiment: ' + error.message + '</div>';
            }
        }

        async function loadTrending() {
            try {
                const data = await apiClient.get('/api/trending');
                
                if (data.trending.length === 0) {
                    document.getElementById('trending-coins').innerHTML = '<div class="empty-state">No trending coins available</div>';
                    return;
                }
                
                let html = '<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px;">';
                data.trending.forEach(coin => {
                    html += `
                        <div style="background: var(--bg-dark); padding: 15px; border-radius: 8px;">
                            <div style="font-weight: 600;">${coin.name}</div>
                            <div style="color: var(--text-muted);">${coin.symbol}</div>
                            ${coin.market_cap_rank ? `<div style="margin-top: 10px;">Rank: #${coin.market_cap_rank}</div>` : ''}
                        </div>
                    `;
                });
                html += '</div>';
                html += `<p style="margin-top: 15px; color: var(--text-muted);">Source: ${data.source}</p>`;
                
                document.getElementById('trending-coins').innerHTML = html;
            } catch (error) {
                console.error('Error loading trending:', error);
                document.getElementById('trending-coins').innerHTML = '<div class="error-message">Failed to load trending: ' + error.message + '</div>';
            }
        }

        // APL Functions
        async function runAPL() {
            const btn = document.getElementById('apl-run-btn');
            btn.disabled = true;
            btn.textContent = '‚è≥ Running APL Scan...';
            
            document.getElementById('apl-status').innerHTML = '<div class="loading">Running APL scan... This may take 1-2 minutes...</div>';
            document.getElementById('apl-output').textContent = 'Executing APL scan...';
            
            try {
                const result = await apiClient.post('/api/apl/run');
                
                if (result.status === 'completed') {
                    document.getElementById('apl-status').innerHTML = `
                        <div class="success-message">
                            ‚úì APL scan completed successfully!<br>
                            Providers count: ${result.providers_count}<br>
                            Time: ${result.timestamp}
                        </div>
                    `;
                    document.getElementById('apl-output').textContent = result.stdout || 'Scan completed.';
                    
                    // Reload summary
                    await loadAPLSummary();
                    
                } else {
                    document.getElementById('apl-status').innerHTML = `<div class="error-message">APL scan ${result.status}: ${result.message || 'Unknown error'}</div>`;
                    document.getElementById('apl-output').textContent = result.stdout || 'No output';
                }
            } catch (error) {
                console.error('Error running APL:', error);
                document.getElementById('apl-status').innerHTML = '<div class="error-message">Failed to run APL: ' + error.message + '</div>';
            } finally {
                btn.disabled = false;
                btn.textContent = 'ü§ñ Run APL Scan';
            }
        }

        async function loadAPLSummary() {
            try {
                const summary = await apiClient.get('/api/apl/summary');
                
                if (summary.status === 'not_available') {
                    document.getElementById('apl-summary').innerHTML = '<div class="empty-state">No APL report available. Run APL scan first.</div>';
                    return;
                }
                
                document.getElementById('apl-summary').innerHTML = `
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="label">HTTP Candidates</div>
                            <div class="value">${summary.http_candidates}</div>
                            <span class="badge badge-success">Valid: ${summary.http_valid}</span>
                        </div>
                        <div class="stat-card">
                            <div class="label">HTTP Invalid</div>
                            <div class="value">${summary.http_invalid}</div>
                            <span class="badge badge-warning">Conditional: ${summary.http_conditional}</span>
                        </div>
                        <div class="stat-card">
                            <div class="label">HF Models</div>
                            <div class="value">${summary.hf_candidates}</div>
                            <span class="badge badge-success">Valid: ${summary.hf_valid}</span>
                        </div>
                        <div class="stat-card">
                            <div class="label">Total Active</div>
                            <div class="value">${summary.total_active}</div>
                            <span class="badge badge-success">Providers</span>
                        </div>
                    </div>
                    <p style="margin-top: 15px; color: var(--text-muted);">Last updated: ${summary.timestamp}</p>
                `;
            } catch (error) {
                console.error('Error loading APL summary:', error);
                document.getElementById('apl-summary').innerHTML = '<div class="error-message">Failed to load APL summary</div>';
            }
        }

        async function loadAPLReport() {
            try {
                const report = await apiClient.get('/api/apl/report');
                
                if (report.status === 'not_available') {
                    showError('APL report not available. Run APL scan first.');
                    return;
                }
                
                document.getElementById('apl-output').textContent = JSON.stringify(report, null, 2);
            } catch (error) {
                console.error('Error loading APL report:', error);
                showError('Failed to load APL report');
            }
        }

        // HF Models
        async function loadHFModels() {
            try {
                const response = await apiClient.get('/api/hf/models');
                
                if (response.count === 0) {
                    document.getElementById('hf-models-container').innerHTML = '<div class="empty-state">No HF models found. Run APL scan to discover models.</div>';
                    return;
                }
                
                let html = '';
                response.models.forEach(model => {
                    const statusClass = model.status === 'VALID' ? 'valid' : model.status === 'CONDITIONALLY_AVAILABLE' ? 'conditional' : 'invalid';
                    html += `
                        <div class="model-card ${statusClass}">
                            <div style="font-weight: 600; margin-bottom: 5px;">${model.provider_name}</div>
                            <div style="color: var(--text-muted); font-size: 13px;">${model.provider_id}</div>
                            <div style="margin-top: 10px;">
                                <span class="badge badge-${statusClass === 'valid' ? 'success' : statusClass === 'conditional' ? 'warning' : 'danger'}">${model.status}</span>
                            </div>
                            ${model.error_reason ? `<div style="margin-top: 10px; color: var(--warning);">${model.error_reason}</div>` : ''}
                        </div>
                    `;
                });
                
                document.getElementById('hf-models-container').innerHTML = html;
            } catch (error) {
                console.error('Error loading HF models:', error);
                document.getElementById('hf-models-container').innerHTML = '<div class="error-message">Failed to load HF models</div>';
            }
        }

        async function loadHFHealth() {
            try {
                const health = await apiClient.get('/api/hf/health');
                
                const statusClass = health.ok ? 'status-online' : 'status-offline';
                document.getElementById('hf-health').innerHTML = `
                    <div style="padding: 20px; background: var(--bg-dark); border-radius: 8px;">
                        <div class="${statusClass}" style="font-size: 24px; font-weight: 700;">${health.ok ? '‚úì Healthy' : '‚úó Unhealthy'}</div>
                        ${health.ok ? `
                            <div style="margin-top: 15px;">
                                <div>Models: ${health.counts.models}</div>
                                <div>Datasets: ${health.counts.datasets}</div>
                                <div>Last refresh: ${new Date(health.last_refresh_epoch * 1000).toLocaleString()}</div>
                            </div>
                        ` : `
                            <div style="margin-top: 15px; color: var(--danger);">Error: ${health.error || health.fail_reason}</div>
                        `}
                    </div>
                `;
            } catch (error) {
                console.error('Error loading HF health:', error);
                document.getElementById('hf-health').innerHTML = '<div class="error-message">Failed to load HF health</div>';
            }
        }

        // Diagnostics
        async function runDiagnostics(autoFix = false) {
            try {
                const result = await apiClient.post('/api/diagnostics/run?auto_fix=' + autoFix);
                
                let html = `
                    <div class="success-message">
                        ‚úì Diagnostics completed<br>
                        Issues found: ${result.issues_found}<br>
                        Time: ${result.timestamp}
                    </div>
                `;
                
                if (result.issues.length > 0) {
                    html += '<div style="margin-top: 20px;"><h4>Issues Found:</h4>';
                    result.issues.forEach(issue => {
                        html += `<div class="log-entry error">${issue.type}: ${issue.message}</div>`;
                    });
                    html += '</div>';
                }
                
                if (result.fixes_applied.length > 0) {
                    html += '<div style="margin-top: 20px;"><h4>Fixes Applied:</h4>';
                    result.fixes_applied.forEach(fix => {
                        html += `<div class="log-entry">${fix}</div>`;
                    });
                    html += '</div>';
                }
                
                document.getElementById('diagnostics-results').innerHTML = html;
            } catch (error) {
                console.error('Error running diagnostics:', error);
                showError('Failed to run diagnostics');
            }
        }

        async function loadLastDiagnostics() {
            try {
                const result = await apiClient.get('/api/diagnostics/last');
                
                if (result.status === 'no_previous_run') {
                    document.getElementById('diagnostics-results').innerHTML = '<div class="empty-state">No previous diagnostics run found</div>';
                    return;
                }
                
                // Display last diagnostics
                document.getElementById('diagnostics-results').innerHTML = `<pre>${JSON.stringify(result, null, 2)}</pre>`;
            } catch (error) {
                console.error('Error loading diagnostics:', error);
                showError('Failed to load diagnostics');
            }
        }

        // Logs
        async function loadRecentLogs() {
            try {
                const response = await apiClient.get('/api/logs/recent');
                
                if (response.count === 0) {
                    document.getElementById('logs-container').innerHTML = '<div class="empty-state">No logs available</div>';
                    return;
                }
                
                let html = '';
                response.logs.forEach(log => {
                    const className = log.level === 'ERROR' ? 'error' : '';
                    html += `
                        <div class="log-entry ${className}">
                            <div class="log-timestamp">${log.timestamp || new Date().toISOString()}</div>
                            <div>${log.message || JSON.stringify(log)}</div>
                        </div>
                    `;
                });
                
                document.getElementById('logs-container').innerHTML = html;
            } catch (error) {
                console.error('Error loading logs:', error);
                document.getElementById('logs-container').innerHTML = '<div class="error-message">Failed to load logs</div>';
            }
        }

        async function loadErrorLogs() {
            try {
                const response = await apiClient.get('/api/logs/errors');
                
                if (response.count === 0) {
                    document.getElementById('logs-container').innerHTML = '<div class="empty-state">No error logs found</div>';
                    return;
                }
                
                let html = '';
                response.errors.forEach(log => {
                    html += `
                        <div class="log-entry error">
                            <div class="log-timestamp">${log.timestamp || new Date().toISOString()}</div>
                            <div>${log.message || JSON.stringify(log)}</div>
                        </div>
                    `;
                });
                
                document.getElementById('logs-container').innerHTML = html;
            } catch (error) {
                console.error('Error loading error logs:', error);
                showError('Failed to load error logs');
            }
        }

        // Utility functions
        function showError(message) {
            alert('Error: ' + message);
        }

        function refreshAllData() {
            loadGlobalStatus();
            loadProviders();
            loadAPLSummary();
        }

        // Auto-refresh every 30 seconds
        setInterval(() => {
            const activeTab = document.querySelector('.tab-content.active').id;
            if (activeTab === 'tab-status') {
                loadGlobalStatus();
            }
        }, 30000);

        // Load initial data
        window.addEventListener('DOMContentLoaded', () => {
            console.log('‚úì Admin Dashboard Loaded - Real Data Only');
            loadGlobalStatus();
        });
    </script>
</body>
</html>
